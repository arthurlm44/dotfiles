---
- name: ensure latest ssh-client is installed
  become: true
  package: name=openssh-client state=latest

- name: install ssh-server
  become: true
  package: name=openssh-server state=latest

- name: disable password access
  become: true
  copy: src=sshd_config dest=/etc/ssh/sshd_config owner=root
  register: result

- name: restart ssh server after setting config
  become: true
  when: result.changed
  service: name=ssh state=restarted enabled=yes

- name: is ssh key already loaded in ssh-agent
  shell: "ssh-add -L | grep id_rsa"
  ignore_errors: true
  register: key_status

- when: key_status.rc != 0
  block:
  - name: eval ssh agent
    shell: "eval `ssh-agent`"

- name: installed authorized keys	
  copy: src=authorized_keys dest=~/.ssh/authorized_keys	

